package main

import (
	"context"
	"fmt"
	"log"
	"os"
	"runtime"
	"time"

	"github.com/UTC-Six/pool/worker_pool"
)

// ğŸ¯ ç»Ÿä¸€æ¼”ç¤ºç¨‹åº - åŒ…å«ä¸‰ç§æµ‹è¯•æ¨¡å¼
//
// ğŸ“ æ–‡ä»¶è¯´æ˜ï¼š
//   unified_demo.go  # ä¸»æ¼”ç¤ºç¨‹åºï¼ˆå½“å‰å”¯ä¸€å¯è¿è¡Œæ–‡ä»¶ï¼‰
//   demo.go         # åŸºç¡€æ¼”ç¤ºï¼ˆå·²æ³¨é‡Šï¼Œéœ€è¦æ—¶å–æ¶ˆæ³¨é‡Šï¼‰
//   simple_demo.go  # ç®€å•æµ‹è¯•ï¼ˆå·²æ³¨é‡Šï¼Œéœ€è¦æ—¶å–æ¶ˆæ³¨é‡Šï¼‰
//   stress_demo.go  # å‹åŠ›æµ‹è¯•ï¼ˆå·²æ³¨é‡Šï¼Œéœ€è¦æ—¶å–æ¶ˆæ³¨é‡Šï¼‰
//
// ğŸš€ ä½¿ç”¨æ–¹æ³•ï¼š
//   go run ./cmd/unified_demo.go simple     # è¿è¡Œç®€å•åŠŸèƒ½æµ‹è¯•
//   go run ./cmd/unified_demo.go enhanced   # è¿è¡Œå¢å¼ºåŠŸèƒ½æ¼”ç¤º
//   go run ./cmd/unified_demo.go stress     # è¿è¡Œå‹åŠ›æµ‹è¯•
//   go run ./cmd/unified_demo.go            # é»˜è®¤è¿è¡Œç®€å•æµ‹è¯•
//
// ğŸ’¡ å¦‚éœ€è¿è¡Œå…¶ä»–æ¼”ç¤ºï¼š
//   1. å–æ¶ˆå¯¹åº”æ–‡ä»¶ä¸­çš„æ³¨é‡Šï¼ˆimportå’Œmainå‡½æ•°ï¼‰
//   2. æ³¨é‡Šæ‰unified_demo.goçš„mainå‡½æ•°
//   3. è¿è¡Œ: go run ./cmd/demo.go ç­‰

func main() {
	args := os.Args // è·å–å‘½ä»¤è¡Œå‚æ•°

	mode := "simple"
	if len(args) > 1 {
		mode = args[1]
	}

	fmt.Printf("ğŸš€ Worker Pool ç»Ÿä¸€æ¼”ç¤ºç¨‹åº - æ¨¡å¼: %s\n", mode)
	fmt.Printf("ç³»ç»Ÿä¿¡æ¯: CPUæ ¸å¿ƒæ•°=%d, GOMAXPROCS=%d\n\n", runtime.NumCPU(), runtime.GOMAXPROCS(0))

	switch mode {
	case "simple":
		runSimpleTest()
	case "enhanced":
		runEnhancedDemo()
	case "stress":
		runStressTests()
	default:
		fmt.Printf("æœªçŸ¥æ¨¡å¼: %s\n", mode)
		fmt.Println("æ”¯æŒçš„æ¨¡å¼: simple, enhanced, stress")
		fmt.Println("é»˜è®¤è¿è¡Œç®€å•æµ‹è¯•...")
		runSimpleTest()
	}
}

// ==================== ç®€å•åŠŸèƒ½æµ‹è¯• ====================
func runSimpleTest() {
	fmt.Println("=== ç®€å•åŠŸèƒ½æµ‹è¯• ===")

	// æµ‹è¯•1: åŸºç¡€åŠŸèƒ½
	fmt.Println("\n--- æµ‹è¯•1: åŸºç¡€Poolåˆ›å»º ---")
	pool := worker_pool.NewPool(
		5,
		worker_pool.WithMaxWorkers(10),
		worker_pool.WithName("test-pool"),
		worker_pool.WithLogger(log.Printf),
	)
	defer pool.Shutdown()

	stats := pool.EnhancedStats()
	fmt.Printf("åˆå§‹çŠ¶æ€ - Min: %d, Max: %d, Core: %d, Strategy: %s\n",
		stats.MinWorkers, stats.MaxWorkers, stats.CoreWorkers, stats.CoreAdjustStrategy)

	// æµ‹è¯•2: ä»»åŠ¡æäº¤
	fmt.Println("\n--- æµ‹è¯•2: ä»»åŠ¡æäº¤ ---")
	for i := 0; i < 3; i++ {
		taskID := i // é¿å…é—­åŒ…é—®é¢˜
		pool.Submit(context.Background(), func(ctx context.Context) (interface{}, error) {
			fmt.Printf("ä»»åŠ¡ %d æ‰§è¡Œä¸­\n", taskID)
			time.Sleep(100 * time.Millisecond)
			return fmt.Sprintf("result-%d", taskID), nil
		})
	}

	time.Sleep(500 * time.Millisecond)
	stats = pool.EnhancedStats()
	fmt.Printf("ä»»åŠ¡æäº¤å - Active: %d, Completed: %d, Total: %d\n",
		stats.ActiveWorkers, stats.Completed, stats.TaskSubmitCount)

	// æµ‹è¯•3: æ‰‹åŠ¨è°ƒæ•´CoreWorkers
	fmt.Println("\n--- æµ‹è¯•3: CoreWorkersè°ƒæ•´ ---")
	fmt.Printf("è°ƒæ•´å‰ CoreWorkers: %d\n", pool.GetCoreWorkers())
	pool.SetCoreWorkers(3)
	fmt.Printf("è°ƒæ•´å CoreWorkers: %d\n", pool.GetCoreWorkers())

	// æµ‹è¯•4: ä¸åŒç­–ç•¥
	fmt.Println("\n--- æµ‹è¯•4: ä¸åŒç­–ç•¥æµ‹è¯• ---")

	// å›ºå®šç­–ç•¥
	fixedPool := worker_pool.NewPool(
		8,
		worker_pool.WithFixedCoreWorkers(2),
		worker_pool.WithName("fixed-pool"),
	)
	defer fixedPool.Shutdown()

	fixedStats := fixedPool.EnhancedStats()
	fmt.Printf("å›ºå®šç­–ç•¥ - Core: %d, Strategy: %s\n", fixedStats.CoreWorkers, fixedStats.CoreAdjustStrategy)

	// ç™¾åˆ†æ¯”ç­–ç•¥
	percentPool := worker_pool.NewPool(
		6,
		worker_pool.WithCoreAdjustStrategy(worker_pool.StrategyPercentage),
		worker_pool.WithLowLoadThreshold(0.4),
		worker_pool.WithName("percent-pool"),
	)
	defer percentPool.Shutdown()

	percentStats := percentPool.EnhancedStats()
	fmt.Printf("ç™¾åˆ†æ¯”ç­–ç•¥ - Core: %d, Strategy: %s, Threshold: %.1f%%\n",
		percentStats.CoreWorkers, percentStats.CoreAdjustStrategy, percentStats.LowLoadThreshold*100)

	fmt.Println("\nâœ… ç®€å•æµ‹è¯•å®Œæˆ")
}

// ==================== å¢å¼ºåŠŸèƒ½æ¼”ç¤º ====================
// å¦‚éœ€è¿è¡Œæ­¤æ¼”ç¤ºï¼Œè¯·ä¿®æ”¹mainå‡½æ•°ä¸­çš„modeä¸º"enhanced"æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°
/*
func runEnhancedDemo() {
	fmt.Println("=== å¢å¼ºç‰ˆWorker Poolç¤ºä¾‹ ===")

	// åˆ›å»ºæ”¯æŒåŠ¨æ€è°ƒæ•´çš„åç¨‹æ± 
	pool := worker_pool.NewPool(
		50, // åˆå§‹minWorkers
		worker_pool.WithMaxWorkers(100),
		worker_pool.WithName("dynamic-pool"),
		worker_pool.WithLogger(log.Printf),

		// åŠ¨æ€è°ƒæ•´é…ç½®
		worker_pool.WithAllowCoreTimeout(true),                             // å…è®¸æ ¸å¿ƒçº¿ç¨‹è¶…æ—¶
		worker_pool.WithKeepAliveTime(60*time.Second),                      // 60ç§’ç©ºé—²è¶…æ—¶
		worker_pool.WithAdjustCheckInterval(5*time.Second),                 // 5ç§’æ£€æŸ¥ä¸€æ¬¡ï¼ˆæ¼”ç¤ºç”¨ï¼‰
		worker_pool.WithCoreAdjustStrategy(worker_pool.StrategyPercentage), // ç™¾åˆ†æ¯”ç­–ç•¥
		worker_pool.WithLowLoadThreshold(0.3),                              // 30%é˜ˆå€¼
	)
	defer pool.Shutdown()

	// åœºæ™¯1: åˆå§‹çŠ¶æ€å±•ç¤º
	fmt.Println("\n=== åœºæ™¯1: åˆå§‹çŠ¶æ€ ===")
	stats := pool.EnhancedStats()
	fmt.Printf("åˆå§‹çŠ¶æ€ - Workers: %d, Core: %d, Strategy: %s, Threshold: %.1f%%\n",
		stats.ActiveWorkers, stats.CoreWorkers, stats.CoreAdjustStrategy, stats.LowLoadThreshold*100)

	// åœºæ™¯2: é«˜è´Ÿè½½æµ‹è¯•
	fmt.Println("\n=== åœºæ™¯2: é«˜è´Ÿè½½æµ‹è¯• ===")
	fmt.Println("æäº¤80ä¸ªä»»åŠ¡...")
	for i := 0; i < 80; i++ {
		taskID := i
		pool.Submit(context.Background(), func(ctx context.Context) (interface{}, error) {
			time.Sleep(100 * time.Millisecond)
			return fmt.Sprintf("task-%d", taskID), nil
		})
	}

	time.Sleep(2 * time.Second) // ç­‰å¾…ä»»åŠ¡å¤„ç†
	stats = pool.EnhancedStats()
	fmt.Printf("é«˜è´Ÿè½½å - Workers: %d, Core: %d, Queue: %d, Completed: %d\n",
		stats.ActiveWorkers, stats.CoreWorkers, stats.QueuedTasks, stats.Completed)

	// åœºæ™¯3: æ‰‹åŠ¨è°ƒæ•´æ ¸å¿ƒworkeræ•°é‡
	fmt.Println("\n=== åœºæ™¯3: æ‰‹åŠ¨è°ƒæ•´æ ¸å¿ƒworker ===")
	fmt.Println("æ‰‹åŠ¨è®¾ç½®æ ¸å¿ƒworkerä¸º15...")
	pool.SetCoreWorkers(15)

	stats = pool.EnhancedStats()
	fmt.Printf("æ‰‹åŠ¨è°ƒæ•´å - Core: %d\n", stats.CoreWorkers)

	// åœºæ™¯4: æµ‹è¯•ä¸åŒç­–ç•¥
	fmt.Println("\n=== åœºæ™¯4: ç­–ç•¥å¯¹æ¯”æµ‹è¯• ===")

	// æµ‹è¯•å›ºå®šç­–ç•¥
	fmt.Println("åˆ‡æ¢åˆ°å›ºå®šç­–ç•¥ï¼Œè®¾ç½®æ ¸å¿ƒworkerä¸º10...")
	fixedPool := worker_pool.NewPool(
		20,
		worker_pool.WithMaxWorkers(50),
		worker_pool.WithFixedCoreWorkers(10), // å›ºå®š10ä¸ªæ ¸å¿ƒworker
		worker_pool.WithLogger(log.Printf),
	)
	defer fixedPool.Shutdown()

	stats = fixedPool.EnhancedStats()
	fmt.Printf("å›ºå®šç­–ç•¥ - Core: %d, Strategy: %s\n", stats.CoreWorkers, stats.CoreAdjustStrategy)

	// åœºæ™¯5: è´Ÿè½½å†å²ç›‘æ§
	fmt.Println("\n=== åœºæ™¯5: è´Ÿè½½å†å²ç›‘æ§ ===")
	fmt.Println("ç­‰å¾…è´Ÿè½½ç›‘æ§æ”¶é›†æ•°æ®...")

	// æäº¤å°‘é‡ä»»åŠ¡æ¨¡æ‹Ÿä½è´Ÿè½½
	for i := 0; i < 5; i++ {
		time.Sleep(6 * time.Second) // ç­‰å¾…ä¸€ä¸ªç›‘æ§å‘¨æœŸ

		// æäº¤å°‘é‡ä»»åŠ¡
		pool.Submit(context.Background(), func(ctx context.Context) (interface{}, error) {
			return "low-load-task", nil
		})

		stats = pool.EnhancedStats()
		fmt.Printf("ç¬¬%dæ¬¡æ£€æŸ¥ - Core: %d, HistoryLength: %d, LastActivity: %v\n",
			i+1, stats.CoreWorkers, stats.LoadHistoryLength,
			time.Since(stats.LastActivityTime).Truncate(time.Second))
	}

	// åœºæ™¯6: çªå‘é«˜è´Ÿè½½æ¢å¤æµ‹è¯•
	fmt.Println("\n=== åœºæ™¯6: çªå‘é«˜è´Ÿè½½æ¢å¤ ===")
	fmt.Println("æ¨¡æ‹Ÿçªå‘é«˜è´Ÿè½½...")
	for i := 0; i < 30; i++ {
		taskID := i
		pool.Submit(context.Background(), func(ctx context.Context) (interface{}, error) {
			time.Sleep(50 * time.Millisecond)
			return fmt.Sprintf("burst-task-%d", taskID), nil
		})
	}

	time.Sleep(3 * time.Second)
	stats = pool.EnhancedStats()
	fmt.Printf("çªå‘è´Ÿè½½å - Core: %d, Active: %d, Completed: %d\n",
		stats.CoreWorkers, stats.ActiveWorkers, stats.Completed)

	// æœ€ç»ˆç»Ÿè®¡
	fmt.Println("\n=== æœ€ç»ˆç»Ÿè®¡ ===")
	finalStats := pool.EnhancedStats()
	fmt.Printf("æœ€ç»ˆçŠ¶æ€:\n")
	fmt.Printf("  - æ ¸å¿ƒWorker: %d\n", finalStats.CoreWorkers)
	fmt.Printf("  - æœ€å°Worker: %d\n", finalStats.MinWorkers)
	fmt.Printf("  - æœ€å¤§Worker: %d\n", finalStats.MaxWorkers)
	fmt.Printf("  - å½“å‰æ´»è·ƒ: %d\n", finalStats.ActiveWorkers)
	fmt.Printf("  - å·²å®Œæˆä»»åŠ¡: %d\n", finalStats.Completed)
	fmt.Printf("  - æ€»æäº¤ä»»åŠ¡: %d\n", finalStats.TaskSubmitCount)
	fmt.Printf("  - è°ƒæ•´ç­–ç•¥: %s\n", finalStats.CoreAdjustStrategy)
	fmt.Printf("  - è´Ÿè½½å†å²é•¿åº¦: %d\n", finalStats.LoadHistoryLength)
	fmt.Printf("  - æœ€åæ´»åŠ¨æ—¶é—´: %v\n", time.Since(finalStats.LastActivityTime).Truncate(time.Second))

	// å±•ç¤ºè´Ÿè½½å†å²ï¼ˆæœ€è¿‘5ä¸ªæ ·æœ¬ï¼‰
	history := pool.GetLoadHistory()
	if len(history) > 0 {
		fmt.Printf("  - æœ€è¿‘5ä¸ªè´Ÿè½½æ ·æœ¬:\n")
		start := len(history) - 5
		if start < 0 {
			start = 0
		}
		for i, sample := range history[start:] {
			fmt.Printf("    %d. Time: %s, Active: %d, Queue: %d\n",
				i+1, sample.Timestamp.Format("15:04:05"), sample.ActiveWorkers, sample.QueueLength)
		}
	}

	fmt.Println("\nâœ… å¢å¼ºåŠŸèƒ½æ¼”ç¤ºå®Œæˆ")
}
*/

func runEnhancedDemo() {
	fmt.Println("ğŸ”§ å¢å¼ºåŠŸèƒ½æ¼”ç¤ºå·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š runEnhancedDemo å‡½æ•°")
	fmt.Println("ğŸ’¡ æç¤ºï¼šè¯¥æ¼”ç¤ºéœ€è¦è¾ƒé•¿æ—¶é—´ï¼ˆçº¦1åˆ†é’Ÿï¼‰ï¼Œé€‚åˆæ·±å…¥äº†è§£åŠ¨æ€è°ƒæ•´ç‰¹æ€§")
}

// ==================== å‹åŠ›æµ‹è¯• ====================
// å¦‚éœ€è¿è¡Œå‹åŠ›æµ‹è¯•ï¼Œè¯·ä¿®æ”¹mainå‡½æ•°ä¸­çš„modeä¸º"stress"æˆ–ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°
/*
func runStressTests() {
	fmt.Println("ğŸš€ Worker Pool ç”Ÿäº§ç¯å¢ƒå‹åŠ›æµ‹è¯•")

	// è¿è¡Œæ‰€æœ‰æµ‹è¯•
	runBasicStressTest()
	runHighConcurrencyTest()
	runLongRunningTest()
	runResourceLeakTest()
	runCoreWorkersAdjustmentTest()
	runErrorHandlingTest()
	runContextCancellationTest()

	fmt.Println("âœ… æ‰€æœ‰å‹åŠ›æµ‹è¯•å®Œæˆï¼")
}

// åŸºç¡€å‹åŠ›æµ‹è¯•
func runBasicStressTest() {
	fmt.Println("\n--- åŸºç¡€å‹åŠ›æµ‹è¯• ---")

	pool := worker_pool.NewPool(20,
		worker_pool.WithMaxWorkers(100),
		worker_pool.WithName("stress-test-pool"),
		worker_pool.WithLogger(log.Printf),
	)
	defer pool.Shutdown()

	numTasks := 10000
	var completed int64
	var errors int64
	var wg sync.WaitGroup

	start := time.Now()

	for i := 0; i < numTasks; i++ {
		wg.Add(1)
		err := pool.Submit(context.Background(), func(ctx context.Context) (interface{}, error) {
			defer wg.Done()

			// æ¨¡æ‹Ÿä¸åŒç±»å‹çš„å·¥ä½œè´Ÿè½½
			workType := atomic.AddInt64(&completed, 1) % 3
			switch workType {
			case 0:
				// CPUå¯†é›†å‹
				sum := 0
				for j := 0; j < 10000; j++ {
					sum += j
				}
				return sum, nil
			case 1:
				// IOå¯†é›†å‹ï¼ˆæ¨¡æ‹Ÿï¼‰
				time.Sleep(1 * time.Millisecond)
				return "io-result", nil
			case 2:
				// æ··åˆå‹
				time.Sleep(500 * time.Microsecond)
				sum := 0
				for j := 0; j < 1000; j++ {
					sum += j
				}
				return sum, nil
			}
			return nil, nil
		})

		if err != nil {
			atomic.AddInt64(&errors, 1)
		}
	}

	wg.Wait()
	duration := time.Since(start)

	stats := pool.EnhancedStats()
	tps := float64(numTasks) / duration.Seconds()

	fmt.Printf("âœ… åŸºç¡€å‹åŠ›æµ‹è¯•å®Œæˆ:\n")
	fmt.Printf("   - ä»»åŠ¡æ•°: %d\n", numTasks)
	fmt.Printf("   - å®Œæˆæ•°: %d\n", completed)
	fmt.Printf("   - é”™è¯¯æ•°: %d\n", errors)
	fmt.Printf("   - ç”¨æ—¶: %v\n", duration)
	fmt.Printf("   - TPS: %.2f\n", tps)
	fmt.Printf("   - æœ€ç»ˆç»Ÿè®¡: Active=%d, Completed=%d, Total=%d\n",
		stats.ActiveWorkers, stats.Completed, stats.TaskSubmitCount)

	if errors > 0 {
		fmt.Printf("âš ï¸  å‘ç° %d ä¸ªé”™è¯¯\n", errors)
	}
	if tps < 500 {
		fmt.Printf("âš ï¸  æ€§èƒ½è¾ƒä½: %.2f TPS (æœŸæœ› > 500)\n", tps)
	}
}

// é«˜å¹¶å‘æµ‹è¯•
func runHighConcurrencyTest() {
	fmt.Println("\n--- é«˜å¹¶å‘æµ‹è¯• ---")

	pool := worker_pool.NewPool(10,
		worker_pool.WithMaxWorkers(200),
		worker_pool.WithName("concurrency-test-pool"),
	)
	defer pool.Shutdown()

	numGoroutines := 100
	tasksPerGoroutine := 100
	var totalCompleted int64
	var wg sync.WaitGroup

	start := time.Now()

	// å¯åŠ¨å¤šä¸ªgoroutineå¹¶å‘æäº¤ä»»åŠ¡
	for i := 0; i < numGoroutines; i++ {
		wg.Add(1)
		go func(goroutineID int) {
			defer wg.Done()
			var localWg sync.WaitGroup

			for j := 0; j < tasksPerGoroutine; j++ {
				localWg.Add(1)
				err := pool.Submit(context.Background(), func(ctx context.Context) (interface{}, error) {
					defer localWg.Done()
					atomic.AddInt64(&totalCompleted, 1)
					// éšæœºå·¥ä½œè´Ÿè½½
					if goroutineID%2 == 0 {
						time.Sleep(100 * time.Microsecond)
					} else {
						sum := 0
						for k := 0; k < 1000; k++ {
							sum += k
						}
					}
					return nil, nil
				})

				if err != nil {
					fmt.Printf("âŒ Goroutine %d æäº¤ä»»åŠ¡å¤±è´¥: %v\n", goroutineID, err)
					localWg.Done() // å¦‚æœæäº¤å¤±è´¥ä¹Ÿè¦è°ƒç”¨Done
				}
			}
			localWg.Wait() // ç­‰å¾…è¯¥goroutineçš„æ‰€æœ‰ä»»åŠ¡å®Œæˆ
		}(i)
	}

	wg.Wait()
	duration := time.Since(start)

	expectedTasks := int64(numGoroutines * tasksPerGoroutine)
	stats := pool.EnhancedStats()

	fmt.Printf("âœ… é«˜å¹¶å‘æµ‹è¯•å®Œæˆ:\n")
	fmt.Printf("   - å¹¶å‘æ•°: %d goroutines\n", numGoroutines)
	fmt.Printf("   - æ¯ä¸ªgoroutineä»»åŠ¡æ•°: %d\n", tasksPerGoroutine)
	fmt.Printf("   - é¢„æœŸä»»åŠ¡æ•°: %d\n", expectedTasks)
	fmt.Printf("   - å®é™…å®Œæˆæ•°: %d\n", totalCompleted)
	fmt.Printf("   - ç”¨æ—¶: %v\n", duration)
	fmt.Printf("   - TPS: %.2f\n", float64(expectedTasks)/duration.Seconds())
	fmt.Printf("   - Workeræ‰©å®¹æƒ…å†µ: Min=%d, Max=%d, å½“å‰Active=%d\n",
		stats.MinWorkers, stats.MaxWorkers, stats.ActiveWorkers)

	if totalCompleted != expectedTasks {
		fmt.Printf("âŒ ä»»åŠ¡å®Œæˆæ•°ä¸åŒ¹é…: æœŸæœ› %d, å®é™… %d\n", expectedTasks, totalCompleted)
	}
}

// å…¶ä»–æµ‹è¯•å‡½æ•°ç±»ä¼¼ï¼Œä¸ºèŠ‚çœç¯‡å¹…è¿™é‡Œçœç•¥...
func runLongRunningTest()         { fmt.Println("â³ é•¿æ—¶é—´è¿è¡Œæµ‹è¯•å·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š") }
func runResourceLeakTest()        { fmt.Println("ğŸ” èµ„æºæ³„éœ²æµ‹è¯•å·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š") }
func runCoreWorkersAdjustmentTest() { fmt.Println("ğŸ”§ CoreWorkersè°ƒæ•´æµ‹è¯•å·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š") }
func runErrorHandlingTest()       { fmt.Println("âŒ é”™è¯¯å¤„ç†æµ‹è¯•å·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š") }
func runContextCancellationTest() { fmt.Println("â¹ï¸  Contextå–æ¶ˆæµ‹è¯•å·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š") }
*/

func runStressTests() {
	fmt.Println("ğŸ”§ å‹åŠ›æµ‹è¯•å·²æ³¨é‡Šï¼Œå¦‚éœ€è¿è¡Œè¯·å–æ¶ˆæ³¨é‡Š runStressTests å‡½æ•°")
	fmt.Println("ğŸ’¡ æç¤ºï¼šå‹åŠ›æµ‹è¯•åŒ…å«å¤šä¸ªæµ‹è¯•ç”¨ä¾‹ï¼Œè¿è¡Œæ—¶é—´è¾ƒé•¿ï¼Œé€‚åˆç”Ÿäº§ç¯å¢ƒéªŒè¯")
	fmt.Println("ğŸ“‹ åŒ…å«çš„æµ‹è¯•ï¼š")
	fmt.Println("   - åŸºç¡€å‹åŠ›æµ‹è¯•ï¼š10000ä¸ªä»»åŠ¡ï¼Œæµ‹è¯•TPSæ€§èƒ½")
	fmt.Println("   - é«˜å¹¶å‘æµ‹è¯•ï¼š100ä¸ªgoroutineå¹¶å‘æäº¤ä»»åŠ¡")
	fmt.Println("   - é•¿æ—¶é—´è¿è¡Œæµ‹è¯•ï¼š10ç§’æŒç»­è´Ÿè½½æµ‹è¯•")
	fmt.Println("   - èµ„æºæ³„éœ²æµ‹è¯•ï¼šåˆ›å»ºé”€æ¯50ä¸ªæ± æ£€æŸ¥å†…å­˜æ³„éœ²")
	fmt.Println("   - CoreWorkersè°ƒæ•´æµ‹è¯•ï¼šæµ‹è¯•ä¸åŒè°ƒæ•´ç­–ç•¥")
	fmt.Println("   - é”™è¯¯å¤„ç†æµ‹è¯•ï¼šæµ‹è¯•panicæ¢å¤å’Œé”™è¯¯å¤„ç†")
	fmt.Println("   - Contextå–æ¶ˆæµ‹è¯•ï¼šæµ‹è¯•ä¸Šä¸‹æ–‡å–æ¶ˆæœºåˆ¶")
}
